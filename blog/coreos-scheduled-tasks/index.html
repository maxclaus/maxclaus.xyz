<!DOCTYPE html>
<html lang="en-gb">
  <head>
    <meta charset="UTF-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Max Claus">
    <title>Max Claus&#x27; website</title>
    <meta name="description" content="">
    <meta property="og:type" content="article" >
    <meta name="image" property="og:image" content="https://maxclaus.xyz/og-image.webp">
    <link rel="stylesheet" href="https://maxclaus.xyz/site.css?h=9652046a01e4d4c12120" >
    <link rel="preconnect" href="https://rsms.me/">
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">
    <link rel="shortcut icon" type="image/png" href="https://maxclaus.xyz/favicon.png"/>
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://maxclaus.xyz/rss.xml">
    <!-- <script src="https://kit.fontawesome.com/f91b95dbd1.js" crossorigin="anonymous"></script> -->
  </head>

  <body>
    <div id="root">
      <header id="header">
        <ul class="breadcrumb">
          <li><a href="/">Max Claus</a></li>
          <li><a href="/blog">Blog</a></li>
        </ul>
        <ul class="menu">
          <li><a href="/">About</a></li>
          <li><a href="/blog/">Blog</a></li>
          <li><a href="/resume/">Resume</a></li>
          <li>
            <input id="dark-mode" type="checkbox" name="dark-mode" aria-label="Toggle theme">
            <label id="theme-toggle" for="dark-mode">
              <svg id="light-mode-icon" viewBox="0 0 32 32" width="20" height="20" preserveAspectRatio="xMidYMid meet">
                <circle cx="15" cy="15" r="6" fill="currentColor" />

                <line
                    id="ray"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    x1="15"
                    y1="1"
                    x2="15"
                    y2="4"
                    ></line>

                <use href="#ray" transform="rotate(45 15 15)" />
                <use href="#ray" transform="rotate(90 15 15)" />
                <use href="#ray" transform="rotate(135 15 15)" />
                <use href="#ray" transform="rotate(180 15 15)" />
                <use href="#ray" transform="rotate(225 15 15)" />
                <use href="#ray" transform="rotate(270 15 15)" />
                <use href="#ray" transform="rotate(315 15 15)" />
              </svg>
              <svg id="dark-mode-icon" viewBox="0 0 32 32" width="20" height="20" preserveAspectRatio="xMidYMid meet">
                <path
                    fill="currentColor"
                    d="
                       M 23, 5
                       A 12 12 0 1 0 23, 25
                       A 12 12 0 0 1 23, 5"
                    />
              </svg>
            </label>
          </li>
        </ul>
      </header>

      <div id="content">
        
<article itemscope itemtype="http://schema.org/BlogPosting" class="blog_post">
  <header>
    <h1 itemprop="name headline">CoreOS scheduled tasks</h1>
    <div class="blog_post__meta">
      <span hidden
            itemprop="author"
            itemscope
            itemtype="http://schema.org/Person">
        <span itemprop="name">Max Claus</span>
      </span>

      
        <span>
          Posted on <span itemprop="datePublished">Feb 1, 2015</span>
        </span>
      

      

      
        <span class="blog_post__meta__sep" aria-hidden="true">Â·</span>
        <span>
          2 min. read
        </span>
      

      
    </div>
  </header>

  <div class="blog_post__body">
    <p>CoreOS uses the Systemd that has built in a bunch of helpful features and tools. For example, instead of using <a href="https://help.ubuntu.com/community/CronHowto">Cron</a> that is the most common way to run scheduled tasks in most of the Linux distributions, Systemd has the Timer unit configuration that schedules the execution of a Service unit.</p>
<p>This past week I had to configure a scheduled backup routine to run everyday at 2 AM. So this examples is what I had to configure on Systemd to run the backup routine daily. The backup script <strong>backup-mongodb.sh</strong> I have not included in this post because it is just a simple Mongodb backup script.</p>
<p>Basically the simplest way to schedule a service is creating a Timer unit with the same name of the service that is going to be executed by the timer.</p>
<h2 id="files">Files<a class="zola-anchor" href="#files" aria-label="Anchor link for: files">ðŸ”—</a></h2>
<h3 id="backup-mongodb-service">backup-mongodb.service<a class="zola-anchor" href="#backup-mongodb-service" aria-label="Anchor link for: backup-mongodb-service">ðŸ”—</a></h3>
<p>It requires the <strong>mongodb.service</strong> is running and it runs the backup script.</p>
<pre data-lang="ini" class="language-ini z-code"><code class="language-ini" data-lang="ini"><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">[Unit]
</span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">Description</span><span class="z-keyword z-operator z-genconfig">=</span></span>Backup of mongodb
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">After</span><span class="z-keyword z-operator z-genconfig">=</span></span>mongodb<span class="z-keyword z-operator z-genconfig">.</span>service
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">Requires</span><span class="z-keyword z-operator z-genconfig">=</span></span>mongodb<span class="z-keyword z-operator z-genconfig">.</span>service
</span><span class="z-source z-genconfig">
</span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">[Service]
</span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">ExecStart</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-keyword z-operator z-genconfig">/</span>bin<span class="z-keyword z-operator z-genconfig">/</span>bash <span class="z-keyword z-operator z-genconfig">/</span>home<span class="z-keyword z-operator z-genconfig">/</span>core<span class="z-keyword z-operator z-genconfig">/</span>backup<span class="z-keyword z-operator z-genconfig">-</span><span class="z-support z-type z-genconfig">routines/backup-mongodb.sh</span>
</span><span class="z-source z-genconfig">
</span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">[Install]
</span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">WantedBy</span><span class="z-keyword z-operator z-genconfig">=</span></span>local<span class="z-keyword z-operator z-genconfig">.</span>target
</span></code></pre>
<h3 id="backup-mongodb-timer">backup-mongodb.timer<a class="zola-anchor" href="#backup-mongodb-timer" aria-label="Anchor link for: backup-mongodb-timer">ðŸ”—</a></h3>
<p>It also requires the <strong>mongodb.service</strong> is running and it triggers the <strong>backup-mongodb.service</strong> every day at 2 AM. Using <strong>Persistent=true</strong> persists information on last time the timer was triggered. For more information about Timer take a look in the <a href="http://www.freedesktop.org/software/systemd/man/systemd.timer.html">documentation</a>.</p>
<pre data-lang="ini" class="language-ini z-code"><code class="language-ini" data-lang="ini"><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">[Unit]
</span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">Description</span><span class="z-keyword z-operator z-genconfig">=</span></span>Runs mongodb backup every day at <span class="z-constant z-numeric z-genconfig">2</span> <span class="z-support z-constant z-genconfig">AM</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">After</span><span class="z-keyword z-operator z-genconfig">=</span></span>mongodb<span class="z-keyword z-operator z-genconfig">.</span>service
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">Requires</span><span class="z-keyword z-operator z-genconfig">=</span></span>mongodb<span class="z-keyword z-operator z-genconfig">.</span>service
</span><span class="z-source z-genconfig">
</span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">[Timer]
</span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">OnCalendar</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-numeric z-genconfig">02</span><span class="z-keyword z-operator z-genconfig">:</span><span class="z-constant z-numeric z-genconfig">00</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">Persistent</span><span class="z-keyword z-operator z-genconfig">=</span></span><span class="z-constant z-language z-genconfig">true</span>
</span><span class="z-source z-genconfig">
</span><span class="z-source z-genconfig"><span class="z-storage z-type z-genconfig">[Install]
</span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">WantedBy</span><span class="z-keyword z-operator z-genconfig">=</span></span>local<span class="z-keyword z-operator z-genconfig">.</span>target
</span></code></pre>
<h2 id="configuring-backup-schedule">Configuring backup schedule<a class="zola-anchor" href="#configuring-backup-schedule" aria-label="Anchor link for: configuring-backup-schedule">ðŸ”—</a></h2>
<p>After created those files we just need to load them into the CoreOS machine and start the timer.</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">BACKUP_NAME</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>backup-mongodb<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> removes from coreos these configurations in case they already exist there</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">fleetctl</span></span><span class="z-meta z-function-call z-arguments z-shell"> destroy <span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">fleetctl</span></span><span class="z-meta z-function-call z-arguments z-shell"> list-units</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>^<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">BACKUP_NAME</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> loads the service and timer units</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">fleetctl</span></span><span class="z-meta z-function-call z-arguments z-shell"> load <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">BACKUP_NAME</span></span>.service</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">fleetctl</span></span><span class="z-meta z-function-call z-arguments z-shell"> load <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">BACKUP_NAME</span></span>.timer</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> starts the timer</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">fleetctl</span></span><span class="z-meta z-function-call z-arguments z-shell"> start <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">BACKUP_NAME</span></span>.timer</span>
</span></code></pre>
<h2 id="status">Status<a class="zola-anchor" href="#status" aria-label="Anchor link for: status">ðŸ”—</a></h2>
<p>Looking the <strong>list-units</strong> you are going to see the timer in <strong>active-waiting</strong> and the service <strong>inactive-dead</strong> status.
Don't worry about the service status. The timer is to start it in the configured time.</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">fleetctl</span></span><span class="z-meta z-function-call z-arguments z-shell"> list-units</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"> backup-mongodb</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">UNIT</span></span><span class="z-meta z-function-call z-arguments z-shell">                        ACTIVE          SUB</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">backup-mongodb.service</span></span><span class="z-meta z-function-call z-arguments z-shell">     inactive        dead</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">backup-mongodb.timer</span></span><span class="z-meta z-function-call z-arguments z-shell">       active          waiting</span>
</span></code></pre>

  </div>

  <footer>
    <a class="blog_post__revision" href="https://github.com/maxclaus/maxclaus.xyz/commits/main/content/blog&#x2F;2015-02-01-coreos-scheduled-tasks.md">revision history</a>
  </footer>
</article>

      </div>
      <footer id="footer">
        <p> Copyright Â© 2025 Max Claus. All rights reserved. </p>
      </footer>
      <div hidden itemscope itemtype="http://schema.org/Person">
        <span itemprop="gender">Male</span>
        <span itemprop="email">maxclaus@posteo.com</span>
        <span itemprop="givenName">Max</span>
        <span itemprop="familyName">Claus</span>
        <span itemprop="name">Max Claus Nunes</span>
        <span itemprop="birthDate">1989-09-12</span>
        <span itemprop="jobTitle">Software Engineer</span>
        <span itemprop="nationality">BR</span>
        <a href="https://maxclaus.xyz" itemprop="url">Portfolio</a>
        <a href="https://maxclaus.xyz/blog" itemprop="url">Blog</a>
        <a href="https://maxclaus.xyz/resume" itemprop="url">Resume</a>
      </div>
    </div>
  </body>
</html>
