<!DOCTYPE html>
<html lang="en-gb">
  <head>
    <meta charset="UTF-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Max Claus">
    <title>Max Claus&#x27; website</title>
    <meta name="description" content="">
    <meta property="og:type" content="article" >
    <meta name="image" property="og:image" content="https://maxclaus.xyz/og-image.webp">
    <link rel="stylesheet" href="https://maxclaus.xyz/site.css?h=9652046a01e4d4c12120" >
    <link rel="preconnect" href="https://rsms.me/">
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">
    <link rel="shortcut icon" type="image/png" href="https://maxclaus.xyz/favicon.png"/>
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://maxclaus.xyz/rss.xml">
    <!-- <script src="https://kit.fontawesome.com/f91b95dbd1.js" crossorigin="anonymous"></script> -->
  </head>

  <body>
    <div id="root">
      <header id="header">
        <ul class="breadcrumb">
          <li><a href="/">Max Claus</a></li>
          <li><a href="/blog">Blog</a></li>
        </ul>
        <ul class="menu">
          <li><a href="/">About</a></li>
          <li><a href="/blog/">Blog</a></li>
          <li><a href="/resume/">Resume</a></li>
          <li>
            <input id="dark-mode" type="checkbox" name="dark-mode" aria-label="Toggle theme">
            <label id="theme-toggle" for="dark-mode">
              <svg id="light-mode-icon" viewBox="0 0 32 32" width="20" height="20" preserveAspectRatio="xMidYMid meet">
                <circle cx="15" cy="15" r="6" fill="currentColor" />

                <line
                    id="ray"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    x1="15"
                    y1="1"
                    x2="15"
                    y2="4"
                    ></line>

                <use href="#ray" transform="rotate(45 15 15)" />
                <use href="#ray" transform="rotate(90 15 15)" />
                <use href="#ray" transform="rotate(135 15 15)" />
                <use href="#ray" transform="rotate(180 15 15)" />
                <use href="#ray" transform="rotate(225 15 15)" />
                <use href="#ray" transform="rotate(270 15 15)" />
                <use href="#ray" transform="rotate(315 15 15)" />
              </svg>
              <svg id="dark-mode-icon" viewBox="0 0 32 32" width="20" height="20" preserveAspectRatio="xMidYMid meet">
                <path
                    fill="currentColor"
                    d="
                       M 23, 5
                       A 12 12 0 1 0 23, 25
                       A 12 12 0 0 1 23, 5"
                    />
              </svg>
            </label>
          </li>
        </ul>
      </header>

      <div id="content">
        
<article itemscope itemtype="http://schema.org/BlogPosting" class="blog_post">
  <header>
    <h1 itemprop="name headline">Consultar valores dentro de uma estrutura XML no banco</h1>
    <div class="blog_post__meta">
      <span hidden
            itemprop="author"
            itemscope
            itemtype="http://schema.org/Person">
        <span itemprop="name">Max Claus</span>
      </span>

      
        <span>
          Posted on <span itemprop="datePublished">May 12, 2012</span>
        </span>
      

      

      
        <span class="blog_post__meta__sep" aria-hidden="true">Â·</span>
        <span>
          3 min. read
        </span>
      

      
    </div>
  </header>

  <div class="blog_post__body">
    <p>Acredito que hoje em dia a maioria dos bancos de dados possui suporte para estruturas XML, sendo um formato de fÃ¡cil manipulaÃ§Ã£o, leitura e bem organizado por possuir uma estrutura formada por nÃ³s e elementos.</p>
<p>JÃ¡ participei de um projeto no qual ao invÃ©s de criarem uma tabela especÃ­fica para relacionar uma lista de aÃ§Ãµes de um usuÃ¡rio em um sistema, foi utilizado uma coluna do tipo XML para manter esta lista de aÃ§Ãµes, o que jÃ¡ atendia perfeitamente a este requisito e eliminando assim a necessidade de possuir mais uma tabela fÃ­sica dentro do schema no banco.</p>
<p>Participei tambÃ©m de outro projeto no qual utilizavam a estrutura XML para enviar uma lista de informaÃ§Ãµes como parÃ¢metro de uma procedure ao banco. O que vejo como uma prÃ¡tica muito melhor, do que enviar a mesma lista separando valores por algum tipo de carÃ¡cter (,;#$%â€¦). Passando os valores em uma estrutura XML, mantÃªm as informaÃ§Ãµes mais claras e organizadas, facilitando em muito tratÃ¡-las no banco e posterior manutenÃ§Ã£o do cÃ³digo.</p>
<p>Uma vez que vocÃª esteja trabalhando com estruturas XMLs, provavelmente em alguma situaÃ§Ã£o serÃ¡ necessÃ¡rio realiza alguma consulta nas informaÃ§Ãµes contidas na mesma.</p>
<h3 id="sql-variable">sql:variable<a class="zola-anchor" href="#sql-variable" aria-label="Anchor link for: sql-variable">ğŸ”—</a></h3>
<p>ExpÃµe uma variÃ¡vel que contÃ©m um valor SQL dentro de uma expressÃ£o XQuery.</p>
<h3 id="exists">exists<a class="zola-anchor" href="#exists" aria-label="Anchor link for: exists">ğŸ”—</a></h3>
<p>Verifica a existÃªncia de uma clÃ¡usula especÃ­fica e retorna um bit que representa uma das seguintes condiÃ§Ãµes:</p>
<ul>
<li>1 â€“ representando Verdadeiro, se a expressÃ£o XQuery em uma consulta retornar um resultado nonempty. Quer dizer, retorna no mÃ­nimo um nÃ³ XML.</li>
<li>0 â€“ representando Falso, se retornar um resultado vazio.</li>
<li>NULL se a instÃ¢ncia de tipo de dado xml na qual a consulta foi executada contiver NULL.</li>
</ul>
<p>Como forma de demonstrar essas funÃ§Ãµes, vamos supor que um sistema de venda Ã© mantido um histÃ³rico de todas as vendas na seguinte tabela:</p>
<table><thead><tr><th><strong>Nome Coluna</strong></th><th><strong>Tipo Dado</strong></th></tr></thead><tbody>
<tr><td>HistoricoId</td><td>int</td></tr>
<tr><td>VendedorIdÂ </td><td>int</td></tr>
<tr><td>DataVendaÂ </td><td>datetime</td></tr>
<tr><td>VendaIdÂ </td><td>int</td></tr>
<tr><td>ProdutosVendidosÂ </td><td>xml</td></tr>
</tbody></table>
<p>Como pode ser visto a cima, serÃ¡ mantido os produtos vendidos em cada venda na seguinte estrutura XML:</p>
<p><code>1 Â Â  3 Â Â  88</code></p>
<p>Agora, digamos que um dos diretores da empresa solicitou que fosse levantado um relatÃ³rio de todas as vendas realizadas por certo vendedor, no qual continha o produto com o cÃ³digo 88. Como fazer isso, sendo que os cÃ³digos dos produtos estÃ£o contidos dentro da estrutura XML?</p>
<p>Dessa forma:</p>
<pre data-lang="sql" class="language-sql z-code"><code class="language-sql" data-lang="sql"><span class="z-source z-sql">DECLAREÂ @VendedorId <span class="z-storage z-type z-sql">INT</span>Â <span class="z-keyword z-operator z-comparison z-sql">=</span>Â <span class="z-constant z-numeric z-sql">10</span>
</span><span class="z-source z-sql">DECLAREÂ @Consulta_XMLÂ <span class="z-storage z-type z-sql">VARCHAR</span>Â <span class="z-keyword z-operator z-comparison z-sql">=</span>Â CAST(@Codigo_ProdutoÂ <span class="z-keyword z-operator z-assignment z-alias z-sql">AS</span>Â <span class="z-storage z-type z-sql">VARCHAR</span>)<span class="z-string z-quoted z-other z-backtick z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">`</span>
</span></span></code></pre>
<pre data-lang="sql" class="language-sql z-code"><code class="language-sql" data-lang="sql"><span class="z-source z-sql"><span class="z-keyword z-other z-DML z-sql">SELECT</span>Â VendaId
</span><span class="z-source z-sql"><span class="z-keyword z-other z-DML z-sql">FROM</span>Â HistoricoVendaÂ 
</span><span class="z-source z-sql"><span class="z-keyword z-other z-DML z-sql">WHERE</span>Â Â Â Â Â Â Â Â 
</span><span class="z-source z-sql">     VendedorIdÂ <span class="z-keyword z-operator z-comparison z-sql">=</span>Â Â @VendedorId
</span><span class="z-source z-sql">Â Â Â Â Â <span class="z-keyword z-operator z-logical z-sql">AND</span>
</span><span class="z-source z-sql">Â Â Â Â Â <span class="z-constant z-other z-database-name z-sql">ProdutosVendidos</span>.<span class="z-constant z-other z-table-name z-sql">exist</span>(<span class="z-string z-quoted z-single z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">&#39;</span>(//Venda/Produto)[.Â =Â sql:variable(&quot;@Consulta_XML&quot;)]<span class="z-punctuation z-definition z-string z-end z-sql">&#39;</span></span>)Â <span class="z-keyword z-operator z-comparison z-sql">=</span>Â <span class="z-constant z-numeric z-sql">1</span><span class="z-string z-quoted z-other z-backtick z-sql"><span class="z-punctuation z-definition z-string z-begin z-sql">`</span>
</span></span></code></pre>
<p>Para que fosse possÃ­vel realizar a busca dentro do XML foi necessÃ¡rio declarar uma variÃ¡vel, na qual a mesma foi exposta dentro XML atravÃ©s da funÃ§Ã£o sql:variable. TambÃ©m foi utilizada a funÃ§Ã£o exists para verificar a existÃªncia de uma informaÃ§Ã£o, definindo a caminho da mestra na estrutura XML.Â  Note tambÃ©m que foi utilizado // antes da Venda, para especificÃ¡-la que estÃ¡ na raiz do XML.</p>

  </div>

  <footer>
    <a class="blog_post__revision" href="https://github.com/maxclaus/maxclaus.xyz/commits/main/content/blog&#x2F;2012-05-12-consultar-valores-dentro-de-uma-estrutura-xml-no-banco.md">revision history</a>
  </footer>
</article>

      </div>
      <footer id="footer">
        <p> Copyright Â© 2025 Max Claus. All rights reserved. </p>
      </footer>
      <div hidden itemscope itemtype="http://schema.org/Person">
        <span itemprop="gender">Male</span>
        <span itemprop="email">maxclaus@posteo.com</span>
        <span itemprop="givenName">Max</span>
        <span itemprop="familyName">Claus</span>
        <span itemprop="name">Max Claus Nunes</span>
        <span itemprop="birthDate">1989-09-12</span>
        <span itemprop="jobTitle">Software Engineer</span>
        <span itemprop="nationality">BR</span>
        <a href="https://maxclaus.xyz" itemprop="url">Portfolio</a>
        <a href="https://maxclaus.xyz/blog" itemprop="url">Blog</a>
        <a href="https://maxclaus.xyz/resume" itemprop="url">Resume</a>
      </div>
    </div>
  </body>
</html>
